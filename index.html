<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>x402rocks Token - Mint Now!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 40px; }
        .header h1 { font-size: 48px; margin-bottom: 10px; }
        .header p { font-size: 20px; opacity: 0.95; }
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        .alert.show { display: block; }
        .alert.success { background: #d1fae5; color: #065f46; }
        .alert.error { background: #fee2e2; color: #991b1b; }
        .alert.info { background: #dbeafe; color: #1e40af; }
        .wallet-address {
            font-family: monospace;
            word-break: break-all;
            color: #667eea;
        }
        .stat-box {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 x402rocks Token</h1>
            <p>Mint 50,000 tokens for $1 USDC on Base Mainnet</p>
        </div>

        <div id="alert" class="alert"></div>

        <div class="card">
            <div id="walletDisconnected">
                <h2>Connect Your Wallet</h2>
                <p style="margin: 15px 0;">Connect MetaMask to start minting</p>
                <button id="connectBtn" class="btn">Connect Wallet</button>
            </div>
            
            <div id="walletConnected" style="display: none;">
                <h2>✅ Wallet Connected</h2>
                <p class="wallet-address" id="walletAddress"></p>
                <p>Balance: <span id="tokenBalance">0</span> x402rocks</p>
                <button id="disconnectBtn" class="btn" style="background: #6b7280; margin-top: 10px;">Disconnect</button>
            </div>
        </div>

        <div class="card">
            <h2>📊 Stats</h2>
            <div class="stat-box">
                <div>Total Mints: <strong id="totalMints">-</strong></div>
                <div>Remaining: <strong id="remainingMints">-</strong></div>
                <div>Revenue: <strong id="totalRevenue">$0</strong></div>
            </div>
        </div>

        <div class="card" id="mintingSection" style="display: none;">
            <h2>🎯 Mint Tokens</h2>
            <p style="margin: 15px 0;">Price: <strong>$1 USDC</strong> = <strong>50,000 tokens</strong></p>
            <button id="mintBtn" class="btn" style="width: 100%;">Mint Tokens</button>
        </div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <script>
        // ⚠️ UPDATE THIS WITH YOUR CONTRACT ADDRESS!
        const CONTRACT_ADDRESS = "0x90AcD7128e5cdb7A4211Db0BE059400e35B329C3";
        const USDC_ADDRESS = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
        
        const ABI = [
            "function mint(address to) external",
            "function balanceOf(address) view returns (uint256)",
            "function getGlobalStats() view returns (uint256,uint256,uint256,uint256)"
        ];
        
        const USDC_ABI = [
            "function approve(address,uint256) returns (bool)",
            "function allowance(address,address) view returns (uint256)"
        ];

        let provider, signer, contract, usdcContract, userAddress;

        function showAlert(msg, type) {
            const alert = document.getElementById('alert');
            alert.textContent = msg;
            alert.className = `alert ${type} show`;
            setTimeout(() => alert.classList.remove('show'), 5000);
        }

        async function connectWallet() {
            console.log('Connecting...');
            if (!window.ethereum) {
                showAlert('Install MetaMask!', 'error');
                return;
            }

            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                const network = await provider.getNetwork();
                if (network.chainId !== 8453) {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x2105' }]
                    });
                }
                
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
                usdcContract = new ethers.Contract(USDC_ADDRESS, USDC_ABI, signer);
                
                document.getElementById('walletDisconnected').style.display = 'none';
                document.getElementById('walletConnected').style.display = 'block';
                document.getElementById('mintingSection').style.display = 'block';
                document.getElementById('walletAddress').textContent = 
                    userAddress.slice(0,6) + '...' + userAddress.slice(-4);
                
                updateBalance();
                updateStats();
                showAlert('Connected!', 'success');
            } catch (e) {
                console.error(e);
                showAlert('Connection failed: ' + e.message, 'error');
            }
        }

        async function updateBalance() {
            try {
                const bal = await contract.balanceOf(userAddress);
                document.getElementById('tokenBalance').textContent = 
                    ethers.utils.formatEther(bal);
            } catch(e) {}
        }

        async function updateStats() {
            try {
                const p = new ethers.providers.JsonRpcProvider('https://mainnet.base.org');
                const c = new ethers.Contract(CONTRACT_ADDRESS, ABI, p);
                const [total, remaining, , revenue] = await c.getGlobalStats();
                document.getElementById('totalMints').textContent = total.toString();
                document.getElementById('remainingMints').textContent = remaining.toString();
                document.getElementById('totalRevenue').textContent = 
                    '$' + ethers.utils.formatUnits(revenue, 6);
            } catch(e) {
                document.getElementById('totalMints').textContent = '0';
                document.getElementById('remainingMints').textContent = '40,000';
            }
        }

        async function mint() {
            try {
                document.getElementById('mintBtn').disabled = true;
                
                const allowance = await usdcContract.allowance(userAddress, CONTRACT_ADDRESS);
                const needed = ethers.utils.parseUnits('1', 6);
                
                if (allowance.lt(needed)) {
                    showAlert('Approving USDC...', 'info');
                    const tx = await usdcContract.approve(CONTRACT_ADDRESS, ethers.constants.MaxUint256);
                    await tx.wait();
                }
                
                showAlert('Minting...', 'info');
                const tx = await contract.mint(userAddress);
                await tx.wait();
                
                showAlert('Minted 50,000 tokens!', 'success');
                updateBalance();
                updateStats();
            } catch(e) {
                showAlert('Error: ' + e.message, 'error');
            } finally {
                document.getElementById('mintBtn').disabled = false;
            }
        }

        document.getElementById('connectBtn').onclick = connectWallet;
        document.getElementById('disconnectBtn').onclick = () => location.reload();
        document.getElementById('mintBtn').onclick = mint;

        updateStats();
        setInterval(updateStats, 15000);
    </script>
</body>
</html>
